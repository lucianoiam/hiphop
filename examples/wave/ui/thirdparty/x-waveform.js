var w=(e,t={})=>new Proxy(e,{get(o,r,l){return t[r]=!0,l},apply(o,r,l){let n={...t};return t={},e.call(r,n).apply(r,l)}});function z(e,t,o,r){return e.addEventListener(t,o,r),()=>q(e,t,o,r)}var C=()=>w(e=>(t,o,r,l={})=>z(t,o,r,{...e.active?{passive:!1}:null,...e,...l})),q=(e,t,o,r)=>e.removeEventListener(t,o,r);var x=class extends String{static create(t,o,r){return new x(t,o,r)}group;get value(){return""+this}get index(){return this.source.index}source;constructor(t,o,r){super(typeof t=="object"?t.value:t),typeof t=="object"&&(o=t.group,r=Object.assign(t.source.match,{index:t.source.index,input:t.source.input})),this.group=o,Object.defineProperty(this,"source",{enumerable:!1,value:r})}toJSON(){return{value:this.value,group:this.group,source:{match:this.source.slice(),index:this.source.index,input:this.source.input}}}is(t,o){return t==this.group&&(o==null||o==this.value)}as(t,o=this.group){return x.create(t,o,this.source)}};var k=e=>e[1]!=null;var j=e=>{if(!e||e.index==null)return null;if(!e.groups)throw new TypeError("RegExp match is missing named groups such as: /(?<group>[a-z])/");let t=Object.entries(e.groups).find(k);return t?x.create(t[1],t[0],e):null};var A=class extends RegExp{[Symbol.match](t){let o=RegExp.prototype[Symbol.match].call(this,t);return j(o)}*[Symbol.matchAll](t){let o=RegExp.prototype[Symbol.matchAll].call(this,t);for(let r of o)yield j(r)}};var F=e=>new RegExp(e.map(t=>t.toString()).map(t=>t.slice(t.indexOf("/")+1,t.lastIndexOf("/"))).join("|"),"gi");var R=(...e)=>{let t=F(e);return o=>{let r=o.matchAll(t),l=()=>j(r.next().value);return Object.defineProperty(l,Symbol.iterator,{value:function*(c){for(;c=l();)yield c}}),l}};var ht=R(/(?<open>\s*\{\s*)/,/(?<close>\s*\}\s*)/,/(?<comment>\/\*[^]*?\*\/)/,/\s*(?<rule>[^{;}/'"]+)\s+?(?={)/,/\s*(?<string>'.*?'|".*?")(?=;)/,/\s*(?<prop>[^:;/]+)(?=:)/,/\s*(?<value>[^:;]+)(?=;)/);var y=(e,t,o)=>Object.defineProperties(e,Object.fromEntries(Object.entries(t).map(([r,l])=>{let n=o(r,l),c=Object.getOwnPropertyDescriptor(e,r);if(c&&c.get&&c.set){let{get:u,set:p}=n;n.get=()=>c.get?.()??u(),n.set=a=>{c.set?.(a),p(c.get?.()??a)}}return[r,{configurable:!0,enumerable:!0,...n}]})));var T=new Map([[String,e=>e.toString()],[Number,e=>parseFloat(e)],[Boolean,e=>e=e===!1?!1:e!=null]]),D=(e,t)=>{for(let[o,r]of Object.entries(t))[String,Number,Boolean].includes(r)&&(t[o]=void 0);return y(e,t,o=>{let r=o.toLowerCase();return{get:()=>t[o],set(l){e.setAttribute(r,l)}}}),t},M=e=>t=>{let o=new Map,r=new Map;for(let[n,c]of Object.entries(new e)){let u=c==null?T.get(String):T.get(c)??T.get(c?.constructor);if(!u)throw new TypeError(`Attribute "${n}" is not valid type, must be either: String, Number, Boolean, null, undefined`);o.set(n,u),r.set(n.toLowerCase(),n)}let l=[...r.keys()];return class extends t{static get observedAttributes(){return l.concat(super.observedAttributes??[])}#t;constructor(...n){super(...n),this.#t=D(this,new e)}attributeChangedCallback(n,c,u){let p;if(p=r.get(n)){let a=this.#t[p],m=o.get(p)(u);Object.is(a,m)||(this.#t[p]=m,this.propertyChangedCallback?.(p,a,m))}super.attributeChangedCallback?.(n,c,u)}}};var H=e=>new Function("event",`with(this){let fn=${e};return typeof fn=='function'?fn.call(this,event):fn}`),P=()=>e=>e.prototype.dispatch?e:class extends e{dispatchEvent(t){let o=`on${t.type}`,r=!0;if(!(o in this.constructor.prototype)){let l=this[o];l||(l=H(this.getAttribute(o))),r=l.call(this,t)}return r!==!1&&super.dispatchEvent(t),r}dispatch(t,o,r){return this.dispatchEvent(new CustomEvent(t,{detail:o,...r}))}};var L=()=>e=>class extends b(e,P()){isMounted=!1;connectedCallback(){super.connectedCallback?.(),this.isMounted||(this.isMounted=!0,this.dispatch("mounted"))}disconnectedCallback(){super.disconnectedCallback?.(),queueMicrotask(()=>{this.isConnected||(this.isMounted=!1,this.dispatch("unmounted"))})}};var E=e=>t=>class extends t{constructor(...o){super(...o),Object.defineProperties(this,Object.fromEntries(Object.entries(new e).map(([r,l])=>[r,{configurable:!0,enumerable:!0,value:l}])))}};var O=(e="",t="")=>o=>class extends o{root=(()=>{let r=this.attachShadow(typeof e=="object"?e:{mode:"open"});return r.innerHTML=typeof e=="string"?e:t,r})()};var I=e=>{let t=e.indexOf("{")+1;if(!t||e.slice(0,t).includes(")"))return[];e=e.slice(t);let o;do o=!1,e=e.replace(/`((\\`)?[^`])+?`|'((\\')?[^'])+?'|"((\\")?[^"])+?"|\([^{[(]*?\)|\{[^{[(]*?\}|\[[^{[(]*?\]/g,()=>(o=!0,""));while(o);return e.split("}")[0].split(",").map(r=>r.split(/[^\w\s$]+/g)[0].trim())},N=(e,t=new Set)=>(I(""+e).forEach(o=>!o||t.add(o)),t);var B=e=>{let t=Symbol(),o=Symbol(),r=Object.entries(e),l=Object.fromEntries(r),n=s=>(s.keys=N(s.fn),s.keys.forEach(i=>{let h=f.get(i);if(!h){console.warn("No effects for key:",i);return}h.push(s)}),!s.keys.size&&f.get(t).push(s),s.values={},u(s)),c=s=>{s.pass=!s.keys.size;for(let i of s.keys){let h=e[i];if(h==null){s.pass=!1;return}Object.is(s.values[i],h)||(s.values[i]=h,s.pass=!0)}},u=s=>{if(c(s),s.dispose?.(),!s.pass){s.values={};return}let i=s.fn(s.values);if(s.cb?.(i)!==!1){if(s.target!=null)return e[s.target]=i,!0;typeof i=="function"&&(s.dispose=()=>{i(),s.dispose=null})}},p={$:{}},a=p.$;a.$=a,y(p.$,e,s=>({get:()=>l[s],set(i){i===o&&(i=m.initial,m.target=s,n(m)||i==null)||(e[s]=i)}})),y(e,e,s=>({get:()=>l[s],set(i){Object.is(l[s],i)||(l[s]=i,f.get(s).forEach(u))}}));let m;a.reduce=(s,i)=>(m={fn:s,initial:i},o),a.effect=(s,i)=>n({fn:s,cb:i});let f;return a.cleanup=()=>{if(f)for(let s of f.values())s.forEach(i=>i.dispose?.());f=new Map([[t,[]],...r.map(([s])=>[s,[]])])},a.cleanup(),a},v=e=>t=>class extends b(t,L()){host=this;constructor(...o){super(...o);let r=B(this);C()(this,"mounted",()=>e.call(this,r)),C()(this,"unmounted",r.cleanup)}};function b(e,...t){return t.reduce((o,r)=>r(o),e)}var Z=`
:host {
  display: inline-flex;
  outline: none;
  user-select: none;
  touch-action: none;
}

:host([autoresize]) {
  width: 100%;
  height: 100%;
  overflow: hidden;
}

:host([autoresize]) canvas {
  width: 100% !important;
  height: 100% !important;
}`,$=class extends b(HTMLElement,O(`<style>${Z}</style><canvas></canvas>`),M(class{autoResize=!1;width=200;height=100;pixelRatio=window.devicePixelRatio;background="#123";color="#1ff"}),E(class{analyser;analyserData;screen;draw;drawFrame;loop;start(){this.loop?.start()}stop(){this.loop?.stop()}}),v(function({$:t,effect:o,reduce:r}){let l;t.screen=r(({root:n})=>{let c=n.querySelector("canvas"),u=c.getContext("2d",{alpha:!1,desynchronized:!0});return{canvas:c,ctx:u}}),o(({screen:{canvas:n,ctx:c},background:u,width:p,height:a,pixelRatio:m})=>{let f=p*m|0,s=a*m|0;(f!==n.width||s!==n.height)&&(n.width=f,n.height=s,n.style.width=p+"px",n.style.height=a+"px",c.fillStyle=u,c.fillRect(0,0,n.width,n.height),c.fillStyle="rgba(0,0,0,0.3)",c.fillRect(0,n.height/2,n.width,n.height/2))}),t.draw=r(({screen:{canvas:n,ctx:c},pixelRatio:u})=>(p,a,m)=>{let f=0,s=0,i;for(let S=a;S<m;S++)i=p[S]**2.1,i>0&&(i>s?s=i:i<f&&(f=i));let h=(s-f)*n.height,g=(n.height-h)/2,d=c.createLinearGradient(0,g,0,g+h);d.addColorStop(0,"rgba(20, 255, 255, 0.28)"),d.addColorStop(.35,"rgba(20, 255, 255, 0.69)"),d.addColorStop(.48,"rgba(20, 255, 255, 0.9)"),d.addColorStop(.5,"rgba(20, 255, 255, 1.0)"),d.addColorStop(.52,"rgba(20, 255, 255, 0.9)"),d.addColorStop(.65,"rgba(20, 255, 255, 0.69)"),d.addColorStop(1,"rgba(20, 255, 255, 0.28)"),c.fillStyle=d,c.fillRect(n.width-u,g,u,h)}),t.drawFrame=r(({analyser:n,analyserData:c,background:u,screen:{canvas:p,ctx:a},pixelRatio:m,draw:f})=>function s(){l=requestAnimationFrame(s),n.getFloatTimeDomainData(c);let i=c;a.globalCompositeOperation="source-over",a.drawImage(p,-1,0,p.width,p.height),a.fillStyle=u,a.fillRect(p.width-m,0,m,p.height);let h=8,g=i.length/h|0;f(i,0,g),a.globalCompositeOperation="lighten";for(let d=1;d<h;d++)f(i,d*g,d*g+g);a.globalCompositeOperation="source-over",a.fillStyle="rgba(0,0,0,0.3)",a.fillRect(p.width-m,p.height/2,m,p.height/2)}),t.analyserData=r(({analyser:n})=>new Float32Array(n.frequencyBinCount)),t.loop=r(({drawFrame:n})=>({start(){l=requestAnimationFrame(n)},stop(){cancelAnimationFrame(l)}})),o(({loop:n})=>(n.start(),()=>n.stop()))})){};export{$ as WaveformElement};
